<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CS460 A5 — Three.js Viewer (local)</title>
<style>
html,body{margin:0;height:100%;background:#0f1837;color:#cbd5e1;font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
#hint{position:fixed;top:8px;left:8px;opacity:.85}
#ui{position:fixed;left:12px;bottom:12px;display:flex;gap:8px;align-items:center;background:#0b122a99;padding:10px 12px;border-radius:12px;backdrop-filter:blur(6px)}
select,button{background:#0f172a;color:#cbd5e1;border:1px solid #29314f;border-radius:10px;padding:6px 10px}
#err{position:fixed;right:12px;bottom#err{;max-width:38ch;background:#2a0f12;color:#ffd7d7;padding:10px 12px;border-radius:10px;border:1px solid #5b1d24;display:none;white-space:pre-wrap}
canvas{display:block}
</style>
<!-- import map resolves bare 'three' used by the example modules -->
<script type="importmap">{
  "imports": { "three": "./three.module.js" }
}</script>
</head><body>
<div id="hint">drag to orbit · ⌘/Ctrl+wheel to zoom</div>
<div id="ui">
  <span>Model:</span>
  <select id="modelSel">
    <option value="Shoe.glb">Shoe.glb (Blender)</option>
    <option value="poly.glb">poly.glb (PolyCam)</option>
  </select>
  <button id="resetBtn">Reset View</button>
</div>
<div id="err"></div>

<script type="module">
const showErr=m=>{const b=document.getElementById('err');b.textContent=m;b.style.display='block';console.error(m)};
window.addEventListener('error',e=>showErr(String(e.error||e.message||e)));

import * as THREE from 'three';
import { OrbitControls } from './OrbitControls.js';
import { GLTFLoader } from './GLTFLoader.js';

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setPixelRatio(Math.min(devicePixelRatio,2));
renderer.setSize(innerWidth,innerHeight);
renderer.outputColorSpace=THREE.SRGBColorSpace;
document.body.appendChild(renderer.domElement);

const scene=new THREE.Scene(); scene.background=new THREE.Color(0x0f1837);
const camera=new THREE.PerspectiveCamera(50,innerWidth/innerHeight,0.01,1000);
camera.position.set(1.2,0.8,1.8);

scene.add(new THREE.HemisphereLight(0xffffff,0x334466,0.6));
const dir=new THREE.DirectionalLight(0xffffff,1.2); dir.position.set(2,3,2); scene.add(dir);

const controls=new OrbitControls(camera,renderer.domElement); controls.enableDamping=true;
const loader=new GLTFLoader(); let current=null;

function fitTo(obj){
  const box=new THREE.Box3().setFromObject(obj);
  if(box.isEmpty()) return;
  const size=box.getSize(new THREE.Vector3()).length();
  const center=box.getCenter(new THREE.Vector3());
  controls.target.copy(center);
  const dist=size*0.9; camera.position.copy(center).add(new THREE.Vector3(dist,dist*0.6,dist));
  camera.near=Math.max(0.01,size/100); camera.far=Math.max(10,size*100); camera.updateProjectionMatrix(); controls.update();
}
function unload(){
  if(!current) return; scene.remove(current);
  current.traverse(o=>{ if(o.geometry) o.geometry.dispose(); const m=o.material; (Array.isArray(m)?m:[m]).forEach(x=>x&&x.dispose&&x.dispose()); });
  current=null;
}
async function loadModel(url){
  try { unload(); const gltf=await loader.loadAsync(url); current=gltf.scene;
        current.traverse(o=>{ if(o.isMesh){o.castShadow=o.receiveShadow=true;} }); scene.add(current); fitTo(current); }
  catch(e){ showErr(`Failed to load ${url}\n\n${e?.message||e}`); }
}

const sel=document.getElementById('modelSel'); const reset=document.getElementById('resetBtn');
sel.addEventListener('change',()=>loadModel(sel.value)); reset.addEventListener('click',()=>current&&fitTo(current));
loadModel(sel.value||'Shoe.glb');

function tick(){ controls.update(); renderer.render(scene,camera); requestAnimationFrame(tick); } tick();
addEventListener('resize',()=>{ camera.aspect=innerWidth/innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth,innerHeight); });
</script>
</body></html>
