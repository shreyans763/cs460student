<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>A5 ‚Äì WebGPU/Babylon viewer</title>
<style>
  :root{--bg:#1e2240;--ui:#0b0f2b;--ink:#e8ecff;--mut:#aab0d9}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);overflow:hidden;font:15px system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  #ui{position:fixed;inset:auto 12px 12px 12px;display:flex;gap:8px;align-items:center;
      background:rgba(11,15,43,.75);backdrop-filter:blur(6px);border:1px solid #22284d;
      padding:10px 12px;border-radius:12px}
  select,button{background:#0e1440;color:var(--ink);border:1px solid #2a3270;border-radius:10px;padding:8px 10px}
  button{cursor:pointer}
  #hint{color:var(--mut)}
  canvas{display:block;width:100vw;height:100vh;outline:none}
</style>
<script src="https://cdn.babylonjs.com/babylon.js"></script>
<script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
</head>
<body>
<canvas id="c"></canvas>
<div id="ui">
  <label>Model:&nbsp;
    <select id="model">
      <option value="Shoe.glb">Shoe.glb (Blender)</option>
      <option value="poly.glb">poly.glb (PolyCam)</option>
    </select>
  </label>
  <button id="reset">Reset View</button>
  <span id="hint">üñ±Ô∏è drag to orbit ¬∑ ‚åò/Ctrl+wheel to zoom</span>
</div>

<script>
(async function(){
  const canvas = document.getElementById('c');
  const engine = new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true, antialias: true });

  let scene = new BABYLON.Scene(engine);
  scene.clearColor = new BABYLON.Color4(0.12, 0.14, 0.25, 1);

  const camera = new BABYLON.ArcRotateCamera("cam", -Math.PI/2, Math.PI/2.25, 2.5, BABYLON.Vector3.Zero(), scene);
  camera.lowerRadiusLimit = 0.4;
  camera.upperRadiusLimit = 10;
  camera.wheelPrecision = 60;
  camera.attachControl(canvas, true);

  new BABYLON.HemisphericLight("h", new BABYLON.Vector3(0.25, 1, -0.25), scene);
  const dir = new BABYLON.DirectionalLight("d", new BABYLON.Vector3(-0.3,-1,-0.2), scene);
  dir.intensity = 0.6;

  let currentRoot = null;

  async function loadModel(filename){
    if (currentRoot) { currentRoot.dispose(); currentRoot = null; }

    // load glb in a fresh container so we can dispose easily
    const container = await BABYLON.SceneLoader.LoadAssetContainerAsync("./", filename, scene);
    currentRoot = new BABYLON.TransformNode("root", scene);
    container.addAllToScene();
    container.meshes.forEach(m => { if (m.parent === null) m.parent = currentRoot; });

    // compute bounds & center/scale nicely
    const meshes = container.meshes.filter(m => m.getTotalVertices() > 0);
    const min = new BABYLON.Vector3(+Infinity,+Infinity,+Infinity);
    const max = new BABYLON.Vector3(-Infinity,-Infinity,-Infinity);
    meshes.forEach(m => {
      const info = m.getBoundingInfo();
      min.minimizeInPlace(info.boundingBox.minimumWorld);
      max.maximizeInPlace(info.boundingBox.maximumWorld);
    });
    const size = max.subtract(min);
    const center = min.add(size.scale(0.5));

    // recentre at origin
    currentRoot.position = currentRoot.position.subtract(center);

    // scale to roughly fit camera distance
    const biggest = Math.max(size.x, size.y, size.z);
    const targetSize = 1.2; // ~ desired unit size
    const s = biggest > 0 ? (targetSize / biggest) : 1.0;
    currentRoot.scaling = new BABYLON.Vector3(s, s, s);

    // subtle ground shadow (blob)
    const g = BABYLON.Mesh.CreateGround("g", 3, 3, 2, scene);
    g.position.y = -0.6;
    const ms = new BABYLON.StandardMaterial("gmat", scene);
    ms.diffuseColor = new BABYLON.Color3(0,0,0);
    ms.specularColor = new BABYLON.Color3(0,0,0);
    ms.emissiveColor = new BABYLON.Color3(0,0,0);
    ms.alpha = 0.0; // invisible ground (kept if you want contact feeling)
    g.material = ms;
  }

  // UI
  const sel = document.getElementById('model');
  const btn = document.getElementById('reset');
  sel.addEventListener('change', () => loadModel(sel.value));
  btn.addEventListener('click', () => {
    camera.setPosition(new BABYLON.Vector3(0, 1.6, 3));
    camera.target = BABYLON.Vector3.Zero();
  });

  await loadModel(sel.value);

  engine.runRenderLoop(() => scene.render());
  window.addEventListener('resize', () => engine.resize());
})();
</script>
</body>
</html>
